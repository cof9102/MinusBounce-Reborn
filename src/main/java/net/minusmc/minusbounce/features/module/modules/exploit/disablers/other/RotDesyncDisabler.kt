package net.minusmc.minusbounce.features.module.modules.exploit.disablers.other

import net.minecraft.network.play.client.C03PacketPlayer.C04PacketPlayerPosition
import net.minecraft.network.play.server.S08PacketPlayerPosLook
import net.minusmc.minusbounce.event.ReceivedPacketEvent
import net.minusmc.minusbounce.features.module.modules.exploit.disablers.DisablerMode
import net.minusmc.minusbounce.utils.PacketUtils

class RotDesyncDisabler : DisablerMode("RotDesync") {

	override fun onReceivedPacket(event: ReceivedPacketEvent) {
		val packet = event.packet
		if (packet !is S08PacketPlayerPosLook)
			return
			
		if (!mc.netHandler.doneLoadingTerrain) {
			debug("not loaded terrain yet")
			return
		}

		event.isCancelled = true
		PacketUtils.sendPacketNoEvent(C04PacketPlayerPosition(packet.x, packet.y, packet.z, false))
		mc.thePlayer.setPosition(packet.x, packet.y, packet.z)
		debug("silent setback")
	}

}